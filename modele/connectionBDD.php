<?php

/**
 *
 */
class accesBD
{
  //-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//--------------------------ATTRIBUTS PRIVES--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	private $hote;
	private $login;
	private $passwd;
	private $base;
	private $bdd;
	private $port;

	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//--------------------------CONSTRUCTEUR------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function __construct()
	{
		$this->hote="localhost";
		$this->port="";
		$this->login="root";
		$this->passwd="";
		$this->base="integration";

		$this->connexion();

	}

	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-----------------------------CONNECTION A LA BASE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	private function connexion()
	{
		try
        {
			//echo "sqlsrv:server=$this->hote$this->port;Database=$this->base"." | ".$this->login." | ".$this->passwd;
			// Pour SQL Server
			//$this->conn = new PDO("sqlsrv:server=$this->hote$this->port;Database=$this->base", $this->login, $this->passwd);
			//$this->conn->setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );

            // Pour Mysql/MariaDB
            $this->bdd = new PDO("mysql:dbname=$this->base;host=$this->hote",$this->login, $this->passwd);
            $this->boolConnexion = true;
        }
        catch(PDOException $e)
        {
            die("Connexion à la base de données échouée".$e->getMessage());
        }
	}


	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//----------------------------REQUEST DE REGISTER ET LOGIN--------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


	public function REQInscription_RegisterVerif_Email($email){

		$success = 0;

		$request = $this->bdd->prepare("SELECT user.email FROM user WHERE user.email = ?");
		if ($request->execute(array($email))) {
			if ($request->rowCount() <= 0) {
				$success = 1;
			}
		}

		return $success;
	}

//Si le success = 0 -> echec. Autrement il est égal à l'id du user.
	public function REQInscription_CreateAccount($name, $firstname, $email, $password){

		$success = 0;

		$request = $this->bdd->prepare("INSERT INTO user (name, firstname, email, password) VALUES (?, ?, ?, ?)");
		if ($request->execute(array($name, $firstname, $email, $password))) {
			$request = $this->bdd->prepare("SELECT user.id FROM user WHERE user.email = ?");
			if ($request->execute(array($email))) {
				$result = $request->fetch();
				$idUser = intval($result["id"]);
				$success = $idUser;
			}
		}

		return $success;
	}
}


 ?>
